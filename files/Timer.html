<!DOCTYPE HTML>
<head>
<style>
::-webkit-scrollbar {
    display: none;
}

html {
 font-size: 4vmin;
}

body {
  margin:0;
  box-sizing: border-box;
  font-family: monospace;
  display: grid;
  height: 90vh;
  place-items: center;
  color: #D7DEE9;
 }

.base-timer {
  position: relative;
  width: 15em;
  height: 15em;
}

/* scaleX(1) = CLOCKWISE, scaleX(-1) = ANTI-CLOCKWISE */
.base-timer__svg {
  transform: scaleX(1);
}

.base-timer__circle {
  fill: none;
  stroke: none;
}

.base-timer__path-elapsed {
  stroke-width: 7px;
  stroke: grey;
}

.base-timer__path-remaining {
  stroke-width: 7px;
  stroke-linecap: round;
  transform: rotate(90deg);
  transform-origin: center;
  transition: 1s linear all;
  fill-rule: nonzero;
  stroke: currentColor;
}

.base-timer__path-remaining.arc {
  color: #5EB3B3;
}

.base-timer__label {
  position: absolute;
  width: 6em;
  height: 6em;
  top: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 2.5em;
}

.buttons {
  box-sizing: border-box;
  display: flex;
  justify-content: space-between;
  align-items: center;
}


.buttons button {
  margin: .7rem;
  border: none;
  background-color: #D7DEE9;
  width: 4em;
  height: 2em;
  border-radius: 5px;
  padding: .1rem;
  font-size: 1.1rem;
  color: #333B45;
}

.buttons button:hover {
  background-color: #5EB3B3;
  color: #333B45;
}

.buttons button:disabled {
  cursor: not-allowed;
  background-color: #FE7C71;
}
</style>


</head>

<body>
  <div class="buttons" id="hideShow">
  <button onclick="stop();myFunction(300);reset()">5分</button>
<button onclick="stop();myFunction(600);reset()">10分</button>
<button onclick="stop();myFunction(900);reset()">15分</button>
<button onclick="stop();myFunction(1500);reset()">25分</button>
</div>
  <div id="app">
    <div class="base-timer">
      <svg class="base-timer__svg" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
        <g class="base-timer__circle">
          <circle class="base-timer__path-elapsed" cx="50" cy="50" r="45"></circle>
          <path id="base-timer-path-remaining" stroke-dasharray="283" class="base-timer__path-remaining arc"
                d="
                   M 50, 50
                   m -45, 0
                   a 45,45 0 1,0 90,0
                   a 45,45 0 1,0 -90,0
                   "></path>
        </g>
      </svg>
      <span id="base-timer-label" class="base-timer__label"></span>
    </div>
  </div>

  <div class="buttons">

    <button onclick="start()" class="start">
      Start
    </button>
    <button onclick="stop()" class="stop">
      Stop
    </button>
    <button onclick="reset()" class="reset">
      Reset
    </button>
  </div>
  <audio id="xyz" src="beep.mp3" preload="auto"></audio>
<script>

if (getUrlVars()["setTime"] < 5) {
  document.getElementById("hideShow").style.display = "none";
}

function getUrlVars() {
    var vars = {};
    var parts = window.location.href.replace(/[?&]+([^=&]+)=([^&]*)/gi, function(m,key,value) {
        vars[key] = decodeURIComponent(value);
    });
    return vars;
}


/*
This script is an extension to the one written
by Mateusz Rybczonec on his CSS Tricks Blog

Blog Link: https://bit.ly/3nH3AhO

OG Pen Link : https://bit.ly/3fi7xXj
*/

const FULL_DASH_ARRAY = 283;
const RESET_DASH_ARRAY = `-57 ${FULL_DASH_ARRAY}`;

//All buttons
let startBtn = document.querySelector(".start");
let stopBtn = document.querySelector(".stop");
let resetBtn = document.querySelector(".reset");

//DOM elements
let timer = document.querySelector("#base-timer-path-remaining");
let timeLabel = document.getElementById("base-timer-label");

let TIME_LIMIT = getUrlVars()["setTime"]*60; //in seconds
let timePassed = -1;
let timeLeft = TIME_LIMIT;
let timerInterval = null;

function myFunction(session) {
//Time related vars
TIME_LIMIT = session; //in seconds
timePassed = -1;
timeLeft = TIME_LIMIT;
timerInterval = null;

    timeLabel.innerHTML = formatTime(TIME_LIMIT);
  setDisabled(stopBtn);
}


function reset() {
  clearInterval(timerInterval);
  resetVars();
  startBtn.innerHTML = "Start";
  timer.setAttribute("stroke-dasharray", RESET_DASH_ARRAY);
}

function start(withReset = false) {
  setDisabled(startBtn);
  removeDisabled(stopBtn);
  if (withReset) {
    resetVars();
  }
  startTimer();
}

function stop() {
  setDisabled(stopBtn);
  removeDisabled(startBtn);
  startBtn.innerHTML = "Resume";
  clearInterval(timerInterval);
}

function startTimer() {
  timerInterval = setInterval(() => {
    timePassed = timePassed += 1;
    timeLeft = TIME_LIMIT - timePassed;
    timeLabel.innerHTML = formatTime(timeLeft);
    setCircleDasharray();

    if (timeLeft === 0) {
	  timeIsUp();
    }
  }, 1000);
}

window.addEventListener("load", () => {
  timeLabel.innerHTML = formatTime(TIME_LIMIT);
  setDisabled(stopBtn);
});



//---------------------------------------------
//HELPER METHODS
//---------------------------------------------
function setDisabled(button) {
  button.setAttribute("disabled", "disabled");
}

function removeDisabled(button) {
  button.removeAttribute("disabled");
}
function timeIsUp() {
  setDisabled(startBtn);
  removeDisabled(stopBtn);
  clearInterval(timerInterval);
  document.getElementById('xyz').play();
  reset();

}

function resetVars() {
  removeDisabled(startBtn);
  setDisabled(stopBtn);
  timePassed = -1;
  timeLeft = TIME_LIMIT;
  console.log(timePassed, timeLeft);
  timeLabel.innerHTML = formatTime(TIME_LIMIT);
}

function formatTime(time) {
  const minutes = Math.floor(time / 60);
  let seconds = time % 60;

  if (seconds < 10) {
    seconds = `0${seconds}`;
  }

  return `${minutes}:${seconds}`;
}

function calculateTimeFraction() {
  const rawTimeFraction = timeLeft / TIME_LIMIT;
  return rawTimeFraction - (1 / TIME_LIMIT) * (1 - rawTimeFraction);
}

function setCircleDasharray() {
  const circleDasharray = `${(
    calculateTimeFraction() * FULL_DASH_ARRAY
  ).toFixed(0)} 283`;
  console.log("setCircleDashArray: ", circleDasharray);
  timer.setAttribute("stroke-dasharray", circleDasharray);
}

</script>
</body>
